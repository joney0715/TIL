# 5장 데이터베이스

* 애플리케이션의 가용성과 성능은 데이터베이스 선택과 구성 방법이 중요
* 데이터베이스는 관계형과 비관계형이 있고, 적합한 데이터베이스를 선택


## 5-1 관계형 데이터베이스

* 관계형 데이터베이스는 하나 이상의 테이블을 포함하고 있으며, 열과 행이 있는 스프레드시트로 시각화 가능
* 관계형 데이터베이스 테이블에서 열은 “속성”, 행은 “레코드” 또는 “튜플”이라고 함

### 열과 속성

* 관계형 데이터베이스 테이블에 데이터를 추가하기 전에, 각 열의 이름과 입력될 데이터의 형식을 사전에 결정 필요
* 열에는 순서가 존재, 테이블을 생성한 후에 순서 변경 불가
* 열의 순서를 정하기 위해, 테이블에 있는 속성 간에 관계 생성 필요
* 데이터는 각 열에서 정의된 형식에 반드시 일치 필요
* 관계형 데이터베이스의 이점
    - 어떻게 데이터를 쿼리할지 이해할 필요 없음
    - 데이터가 일관된 형식으로 존재하는 한 필요한 데이터를 쿼리를 가공해서 원하는 방식으로 얻을 수 있음
* 임의의 열에 데이터를 쿼리하고 사용자가 데이터 제공 방식을 지정해야하는 애플리케이션에 적합

### 다중 테이블 사용

* 모든 데이터를 단일 테이블에 저장하면 불필요한 중복이 생기므로 애플리케이션은 다중 테이블을 연결해서 사용
* 상위 테이블을 만들고 상위 테이블에 관계된 하위 테이블을 생성
* 상위 테이블의 ID는 기본 키라고 하며, 기본 키는 행을 고유하게 식별하기 위해서 테이블 내에서 유일해야 함
* 하위 테이블은 상위 테이블의 ID를 외래 키로 참조
* 데이터베이스가 여러 테이블의 열이 어떻게 연관됐는지 알 수 있도록 기본 키와 외래 키를 반드시 정해야 함

### SQL

* 관계형 데이터베이스에서는 구조화 징의 언어(SQL)를 사용해 데이터를 저장하고 쿼리하고 유지 관리 수행
* SQL문은 관계형 데이터베이스 관리 시스템마다 약간 다름

* 데이터 쿼리 (SELECT 문)
    - SQL 데이터베이스에서 데이터를 쿼리하는데 사용
    - 데이터베이스에서 조회하고 싶은 특정 열을 지정 가능
    - 모든 열에서 값을 기반으로 쿼리 가능
    - SELECT 문과 JOIN 절을 사용해 여러 테이블의 데이터를 결합 가능
* 데이터 저장 (INSERT 문)
    - 테이블에 직접 데이터를 삽입 가능
    - 대량의 레코드를 저장해야 할 때, COPY 명령을 사용하면 적절하게 형식을 맞춘 파일에서 지정한 테이블로 복사 가능

### 온라인 트랜잭션 처리와 온라인 분석 처리

* 관계형 데이터베이스는 구성에 따라 두 가지로 나뉨
    - 온라인 트랜잭션 처리 (Online Transaction Processing, OLTP)
    - 온라인 분석 처리 (Online Analytical Processing, OLAP)

* OLTP
    - OLTP 데이터베이스는 초당 몇 회씩 순차적으로 데이터를 빈번하게 읽고 쓰는 애플리케이션에 적합
    - 빠른 쿼리에 최적화 (이러한 쿼리는 정기적이고 예측 가능한 경향 존재)
    - 빠른 액세스를 위해 자주 사용하는 테이블 일부를 메모리에 저장하기 때문에 메모리가 상당히 필요
    - 일반적으로 단일 서버에 충분한 메모리와 컴퓨팅 성능을 갖추고 OLTP 쓰기 작업 처리
    - 많은 트랜젝션을 처리해야하는 온라인 주문 시스템에 적합
* OLAP
    - OLAP 데이터베이스는 복잡한 대형 데이터 세트 쿼리에 최적화
    - 상당한 스토리지와 컴퓨팅이 필요
    - 데이터웨어하우징 애플리케이션을 구축해 여러 OLTP 데이터베이스를 단일 OLAP 데이터베이스로 모으는 것이 일반적


## 5-2 Amazon Relational Database Service (Amazon RDS)

* RDS는 클라우드에서 관계형 데이터베이스 시스템을 실행할 수 있게 하는 관리형 데이터베이스 서비스
* 데이터베이스 시스템 설정, 백업 수행, 고가용성 보장, 데이터베이스와 기반 운영 체제 패치 적용 등의 작업 관리
* 데이터베이스 장애로부터 복구, 데이터 복원, 데이터베이스 확장을 쉽게 해서 애플리케이션이 요구하는 수준의 가용성과 성능 달성 가능

* RDS를 사용해 데이터베이스를 배포할 때, 데이터베이스 인스턴스 구성 필요
* 데이터베이스 인스턴스는 지정한 VPC에 존재하나, EC2와 다르게 AWS가 전적으로 관리
* SSH로 액세스 불가, EC2 사이에서도 보이지 않음

### 데이터 베이스 엔진

* 데이터베이스 엔진은 데이터베이스에 데이터를 저장, 구성, 반환하는 소프트웨어
* 데이터베이스 인스턴스는 하나의 데이터베이스 엔진만 실행
* 다음 여섯 가지 데이터베이스 엔진 중에서 선택 가능
    1. MySQL
        - OLTP 애플리케이션용으로 설계
    2. MariaDB
        - MariaDB는 MySQL과 바이너리 수준의 호환성을 가지면서 기능을 향상한 데이터베이스
    3. Oracle
        - Oracle은 가장 널리 배포된 DBMS
        - 일부 애플리케이션은 데이터베이스 사양으로 Oracle 데이터베이스를 명시하기도 함
        - Standard Edition(1,2), Enterprise Edition 제공
    4. PostgreSQL
        - PostgreSQL은 Oracle과 호환되는 오픈 소스 데이터베이스
        - Oracle 기반으로 애플리케이션을 개발하고, 비용 절감을 위해 PostgreSQL 선택
    5. Amazon Aurora
        - Aurora는 Amazon이 MySQL과 PostgreSQL과 바이너리 수준의 호환성을 가지면서 기능을 향상시킨 데이터베이스
        - 가상 스토리지 계층을 사용해서 하부 스토리지 쓰기 횟수를 줄이기 때문에 성능이 우수
        - MySQL과 PostgreSQL과 원활하게 마이그레이션 가능하도록 설계
        - Aurora Backtrack 기능으로 데이터베이스를 72시간 이내 특정 시점으로 몇 초만에 복구 가능
    6. Microsoft SQL
        - 다양한 기능을 사용해서 데이터베이스 업그레이드를 수행하지 않고도 온프레미스에 배포된 기존 SQL server 데이터베이스를 RDS로 마이그레이션 가능

### 라이선스 고려사항

* RDS는 데이터베이스 엔진을 실행하는 데 필요한 두 가지 소프트웨어 라이선스 모델 제공
* 라이선스가 포함된 모델은 RDS 인스턴스 요금에 라이선스 비용이 포함
* 기존 보유라이선스 사용 모델을 선택하려면 실행 중인 데이터베이스 엔진의 라이선스를 확보 필요

### 데이터베이스 옵션 그룹

* 데이터베이스 엔진은 데이터베이스 관리와 보안 향상을 지원하는 다양한 기능을 제공
* 옵션 그룹은 옵션이라는 관리 및 보안 기능을 지정해서 하나 이상의 인스턴스에 적용 가능하게 함
* 옵션 사용에는 추가적인 메모리가 필요하므로 활성화 전에 메모리 확인 필요

### 데이터베이스 인스턴스 클래스

* 데이터베이스 인스턴스를 시작할 때 처리 성능, 메모리, 네트워크 대역폭, 디스크 처리량이 어느 정도 필요한지 결정 필요
* RDS는 다양한 데이터베이스 인스턴스 클래스 제공 (세 가지 유형 존재)
* 인스턴스를 다른 클래스로 전환 가능
* 데이터베이스 인스턴스는 EBS 스토리지를 사용

1. 표준
    - 표준 인스턴스 클래스는 데이터베이스 요구를 대부분 충족
    - 최신 세대 인스턴스 클래스 db.m4의 사양
        - 256 GB 메모리
        - 64 vCPU
        - 25 Gbps 네트워크 대역폭
        - 10,000 Mbps (1,280 MBps) 디스크 처리량

2. 메모리 최적화
    - 높은 처리 성능이 요구되는 데이터베이스용
    - 메모리에 더 많은 데이터를 저장할 수 있으므로 쿼리 시간이 빨라짐
    - 최신 세대 인스턴스 클래스 db.x1e의 사양
        - 3,904 GB 메모리
        - 128 vCPU
        - 25 Gbps 네트워크 대역폭
        - 14,000 Mbps (1,750 MBps) 디스크 처리량

3. 순간 확장 가능
    - 개발, 테스트, 다른 비프로덕션 데이터베이스를 위한 인스턴스
    - db.t2의 사양
        - 32 GB 메모리
        - 8 vCPU
        - 보통의 네트워크 성능 (보통 1 Gbps 미만)
        - 3,200 Mbps (400 MBps) 미만의 디스크 처리량

### 스토리지

* IOPS 이해
        - AWS는 초당 입축력 작업(Input/Output Operations Per Second)을 사용해 스토리지 성능을 측정
        - IOPS가 높을수록 데이터를 저장하고 검색하는 속도가 빨라짐
        - RDS는 스토리지 타입에 따라 IOPS를 할당할 수 있으나 임곗값을 초과 불가
        - 단일 I/O 작업에서 전송할 수 있는 데이터의 양은 데이터베이스 엔진이 사용하는 페이지 크기에 달림
        - 페이지가 클수록 단일 I/O 작업에서 더 많은 데이터를 전송 가능
            - MySQL, MariaDB의 페이지 크기는 16KB이므로, 디스크에 16KB의 데이터 쓰기가 하나의 I/O 작업을 구성
            - Oracle, PostgreSQL, Microsoft SQL Server는 8KB 크기의 페이지 사용, 디스크 16KB의 데이터 쓰기에 두번의 작업 필요
        - IOPS수와 페이지 크기는 반비례 관계, 페이지 크기가 클수록 같은 처리량을 달성하는데 필요한 IOPS는 적어짐

1. 범용 SSD
    - 속도가 빠르고 한 자릿수 밀리초 지연 시간 제공
    - 최대 16TB의 볼륨 할당 가능
    - 기본적으로 기가바이트당 3 IOPS 성능을 볼륨에 할당, 최대 10,000 IOPS까지 할당 가능 (볼륨이 커질수록 성능 향상)
    - 데이터베이스 엔진에 따라 스토리지 볼륨의 최소 크기는 다름
    - 큰 볼륨은 필요없지만 높은 IOPS를 할당하고 싶을때는 순간 확장 기능 사용 가능 
        - 인스턴스 생성시 할당되는 크래딧이 다 떨어질때까지 순간 확장 지속 가능
        - 1초 마다 볼륨에 따라 다른 값의 크래딧이 충전

2. 프로비저닝된 IOPS SSD (io1)
    - 프로비저닝된 IOPS SSD를 사용하면 인스턴스를 만들 때 필요한 IOPS 수를 간단한게 할당 가능
    - io1 스토리지에서는 순간 확장의 개념이 없음
    - 프로비저닝된 IOPS 수는 사용 여부와 관계없이 일정한 성능이 제공되고 그에 따른 비용이 청구
    - 일관된 짧은 지연 시간에 성능이 필요한 OLTP 데이터베이스에 유용
    - RDS는 프로비저닝된 IOPS의 성능 변동 범위가 10% 이내로 유지되는 기간을 1년의 99.9%로 보장

3. 마그네틱 스토리지
    - RDS는 구형 인스턴스의 호환성을 위해 마그네틱 스토리지를 제공
    - 최대 크기 4TB, 최대 성능은 1,000 IOPS

### 읽기 전용 복제본

* 메모리, 컴퓨팅, 네트워크 속도, 디스크 처리량에 문제가 있을 때 더 큰 인스턴스 클래스로 업그레이드 가능 (수직 확장)
* 수직 확장(Scale Up)은 간단하게 실행할 수 있는 방식
* 데이터베이스 인스턴스에 더 많은 리소스를 투여하므로 애플리케이션이나 데이터베이스의 변경 불필요

* 수평확장(Scale Out)은 읽기 전용 복제본이라는 추가 데이터베이스 인스턴스 생성 작업 필요
* Oracle, Microsoft SQL Server를 제외한 모든 데이터베이스 엔진은 읽기 전용 복제본 지원
* Aurora에는 Aurora 복제본이라는 특정 유형의 읽기 전용 복제본 지원

* 읽기 전용 복제본은 데이터베이스 쿼리만 제공하는 데이터베이스 인스턴스
* 마스터 데이터베이스 인스턴스의 쿼리 부하 부분을 맡음
* 마스터 데이터베이스 인스턴스는 데이터 쓰기만을 책임
* 읽기 작업량이 매우 많은 애플리케이션에 적합

* RDS는 최대 5개 읽기 전용 복제본을 둘 수 있음 (Aurora는 최대 15개)
* 모든 읽기 전용 복제본에 비동기로 복제되므로 저장 지연 발생 -> 읽기 전용 복제본은 재해 복구에 적합하지 않음

* RDS는 읽기 전용 복제본을 만들면 도메인 이름을 제공(읽기 전용 엔드포인트)
* 사용자는 데이터를 읽기만을 하는 분석 도구가 있다면 그 도구에 읽기 전용 엔드포인트를 지정

* 마스터와 읽기 전용 복제본을 다른 가용 영역, 다른 리전에 둘 수 있음
* 마스터에 장애가 발생한 경우 복제본을 마스터로 승격 가능 (데이터 손실은 감수 필요)

### 고가용성(다중-AZ)

* RDS의 다중AZ 배포를 통해 여러 가용 영역에 데이터베이스 인스턴스 여러 개를 배포
* 다중AZ 배포를 사용
    *  한 가용 영역에 읽기 및 쓰기를 처리하는 기본 데이터베이스 인스턴스를 둠
    * 다른 가용 영역에는 예비 데이터베이스 인스턴스를 둠
    * 기본 인스턴스가 중단되면 보통 2분 이내에 예비 인스턴스로 장애 조치가 수행
* 데이터베이스 인스턴스를 만들 때나 만든 후라도 다중 AZ를 구성할 수 있음

1. Oracle, PosrgreSQL, MariaDB, MySQL, Microsoft SQL Server에서 다중AZ

    * 다중 AZ 배포시, 모든 인스턴스가 같은 리전에 있어야함
    * RDS는 주 인스턴스에서 예비 인스턴스로 데이터를 동기식으로 복제
    * 복제할 때 지연이 발생할 수 있으므로 EBS 최적화 인스턴스와 프로비저닝된 IOPS SSD 스토리지를 사용 필수
    * 예비 인스턴스는 읽기 전용 복제본이 아니므로 읽기 트래픽은 처리 못함

2. Amazon Aurora에서 다중AZ

    * Amazon Aurora 클러스터는 기본 인스턴스로 구성
    * 항상 기본 인스턴스를 가리키는 클러스터 엔드포인트를 제공
    * Aurora 클러스터에는 Aurora 복제본도 포함될 수 있음
    * 기본 복제본과 모든 복제본은 단일 클러스터 볼륨을 공유
        - 3개의 가용 영역에 걸쳐 복제
        - 필요에 따라 최대 64TB까지 자동으로 확장
    * 기본 인스턴스에 장애가 발생했을 때 Aurora 복제본이 없으면 Aurora는 새로운 기본 인스턴스를 생성
    * 복제본이 있으면 Aurora는 복제본을 기본 복제본으로 승격시킴

### 백업과 복구

* RDS는 데이터베이스 인스턴스의 EBS 볼륨 스냅샷 기능을 제공
* 일반 EBS 스냅샷처럼 인스턴스에 기반한 모든 데이터베이스는 스냅샷을 생성해서 S3에 저장 가능
* 스냅샷은 중복성을 위해 같은 리전의 여러 영역에 보관
* Microsoft SQL Server이외의 데이터베이스 엔진에서는 다중 AZ를 사용하지 않는한 스냅삿을 하면 몇 초 동안 I/O 작업이 일시 중단
    - 사용량이 적은 시간에 스냅샷을 만들어야함
* 백업 및 복구가 필요할 때 고려해야 할 두 가지 지표
    - 복구 목표 시간(RTO, Recovery Time Object) : 장애 후 데이터를 복구하고 처리를 재개하는 데까지 최대 허용 시간
    - 복구 목표 지점(RPO, Recovery Point Object) : 데이터 손실을 허용할 수 있는 최대 기간
* RDS 스냅샷을 복구할 때 스냅샷을 새 인스턴스로 복구하는데, 복구 시간은 몇 분정도 걸리며 크기에 따라 차이가 있음
* 새 인스턴스에 더 빠른 성능의 프로비저닝된 IOPS를 할당하면 복구 시간이 빨라짐

### 자동화된 스냅샷

* RDS는 매일 30분 백업 기간에 인스턴스 스냅샷을 자동 생성 가능
    - 이 기간은 사용자가 지정 혹은 RDS가 자동으로 수행
* 스냅샷을 진행하면 성능에 영향을 주기 때문에 데이터베이스가 가장 적게 사용되는 시간에 진행 권장

* 자동 백업을 사용하면 특정 시점 복구가 가능
* 데이터베이스 변경 로그를 5분 마다 S3로 저장 (장애 발생시 최대 5분의 데이터 손실)

* RDS는 자동화된 스냅샷을 일정 기간동안 유지 후 삭제 (사용자가 1 ~ 35일 보존 기간 선택 가능, 기본값 7일)
* 자동 스냅샷을 비활성화하면 기존의 자동화 스냅샷 전부 삭제됨
* 보존 기간을 0에서 다른 값을 변경하면 즉시 스냅샷 트리거

* 수동 스냅샷은 자동화된 스냅샷과 달리 삭제할 때까지 유지
* 인스턴스를 삭제하면 사용자는 RDS의 최종 스냅샷 작업 수행 여부와 자동 스냅샷 유지 여부를 선택
* 최종 스냅샷과 모든 수동 스냅샷은 유지되지만 자동 백업을 유지를 선택하지 않으면 자동 스냅샷은 즉시 삭제

### 유지 관리 항목

* RDS는 관리형 서비스이므로 패치 및 업그레이드는 AWS의 책임
* 데이터베이스 인스턴스에서 운영 체제 보안과 안정성 패치 등의 유지 관리를 정기적으로 수행
* 유지 관리 기간을 매주 30분으로 지정해 유지 관리 작업이 수행되는 시기를 지정 가능
* 유지 관리와 백업을 같은 기간에 지정 가능
* 유지 관리를 30분으로 설정해도 작업은 유지 관리 기간을 넘어서 수행될 수 있음


## 5-3 Amazon Redshift

* Redshift는 OLAP 데이터베이스를 위해 설계된 PostgreSQL 기반의 관리형 데이터 웨어하우스 솔루션
* Redshift는 RDS에 속해 있지 않음
* Redshift는 열 기반 스토리지를 사용해 서로 인접한 열에 값을 저장
    - 저장 속도와 효율성이 향상
    - 개별 열의 데이터를 더 빨리 쿼리 가능
* Redshift는 ODBC와 JDBC 데이터베이스 커넥터를 지원
* Redshift는 압축 인코딩을 사용해 각 열이 스토리지에서 차지하는 크기를 줄임

### 컴퓨팅 노드

* Redshift 클러스터에는 두 가지 범주로 나눠진 하나 이상의 컴퓨팅 노드가 있음
* 고밀도 컴퓨팅 노드는 마그네틱 스토리지에 최대 326TB 데이터 저장 가능
* 고밀도 스토리지 노드는 고속 SSD에 최대 2PB 데이터를 저장 가능
* 클러스터에 둘 이상의 컴퓨팅 노드가 있을 때 클라이언트와의 통신, 컴퓨팅 노드 간의 통신을 조정하는 리더 노드가 포함
* 리더 노드는 추가 비용 없음

### 데이터 분산 스타일

* Redshift 데이터베이스의 행은 컴퓨팅 노드에 걸쳐 분산
* 데이터가 분산되는 방식은 분산 스타일에 따라 다름
* “EVEN 분산”은 기본 스타일, 리더 노드가 데이터를 모든 컴퓨팅 노드에 걸쳐 고르게 분산
* “KEY 분산”은 열 1개 값에 따라 데이터를 분산, 같은 값을 가진 열은 같은 노드에 저장
* “ALL 분산”에서는 테이블이 컴퓨팅 노드에 분산


## 5-4 비관계형 데이터베이스 (NoSQL)

* 비관계형 데이터베이스는 초당 수만 개의 트랜잭션을 일관성 있게 처리하도록 설계
* 관계형 데이터베이스에서 다룰 수 있는 데이터를 저장 가능하더라도 비관계형 데이터베이스는 비정형 데이터라고 하는 것에 최적화
* 비관계형과 관계형 데이터베이스의 공통된 요소
    - 비관계형 데이터베이스는 컬렉션으로 구성, 컬렉션은 테이블이라고도 불림
    - 비관계형 데이터베이스에서 행 또는 튜플과 유사한 항목이 테이블에 저장
    - 각 항목은 하나 이상의 속성으로 구성, 이 속성은 칼럼에 해당
    - 속성은 키, 데이터 형식, 값이라고 하는 고유한 이름으로 구성
    - 속성은 키- 값 페어로도 불림

### 데이터 저장

* 비관계형 데이터베이스가 관계형 데이터베이스와 가장 다른 점
    - 비관계형 데이터베이스에는 스키마가 없음
    - 테이블의 모든 항목이 같은 속성을 갖도록 요구하지 않음
* 각 항목에는 테이블 내에서 고유한 값이 있는 기본 키 속성 필요
    - 기본 키는 항목을 고유하게 식별하고 값에 따라 정렬하기 위해서 사용
* 비관계형 데이터베이스는 저장 데이터 형식이 유연할 때 사용
* 테이블을 만들 때 기본 키 속성 이외에는 속성을 미리 정의하지 않아도 됨
* 비관계형 데이터베이스에서는 여러 테이블에 걸쳐 데이터를 나눈 뒤 이 데이터를 병합해서 쿼리할 수 있는 방법이 없음
    - 애플리케이션은 모든 데이터를 하나의 테이블에 보관
    - 이는 데이터 중복으로 이어지고 데이터베이스가 커지면 심각한 스토리지 비용 발생 주의

### 데이터 쿼리

* 비관계형 데이터베이스는 비정형 데이터를 저장 가능한 유연성이 장점
* 쿼라가 제한돼 있다는 단점
* 기본 키 기반의 쿼리에 최적화
* 다른 속성을 쿼리할 때 속도가 느려지므로 복잡하거나 임의의 쿼리에는 접합하지 않음
* 테이블을 만들기 전에 데이터에 어떠한 쿼리를 수행할지 정확히 이해 필요

### 비관계형 데이터베이스 유형

* 비관계형 데이터베이스가 키-값 저장소, 문서 지향적 저장소, 그래프 데이터베이스 등으로 분류됨
* 키-값 저장소가 기본적인 비관계형 데이터베이스
* 문서 지향적 저장소는 값으로 저장된 문서의 내용을 분석, 메타 데이터를 추출하는 특정한 비관계형 데이터베이스 애플리케이션
* 그래프 데이터베이스는 여러 항목에 있는 속성 간의 관계를 분석
    - 레코드간의 관계를 묶는 관계형 데이터베이스와는 다름


## 5-5 DynamoDB

* DynamoDB는 초당 수천 개 읽기 및 쓰기를 처라할 수 있는 관리형 비관계형 데이터베이스 서비스
* 데이터를 여러 파티션에 걸쳐 분산시켜서 고성능
* 파티션은 테이블용 스토리지 할당, 여러 가용 영역의 SSD에 백업

### 파티션 / 해시 키

* 테이블을 만들 때 기본 키와 데이터 형식 지정 필요
* 기본 키는 테이블의 항목을 고유하게 식별, 그 값은 테이블 내에서 유일해야함 (두 가지 유형의 기본 키 생성 가능)
    - 파티션 키는 해시 키라고도 하며 단일 값을 가지는 기본 키 (이메일 주소, ID식별자 등이 적합)
    - 파티션 키만 기본 키로 사용할 때 이를 단순 기본 키라 함
    - 파티션 키로 저장 가능한 최대 크기는 2,048 바이트
    - 기본 키로 파티션 키와 정렬 키를 조합해서 사용한 것을 복합 기본 키라 함
    - 파티션 키는 고유할 필요는 없지만 파티션 키와 정렬 키의 조합은 고유해야함
* DynamoDB는 기본 키를 기반으로 파티션에 걸쳐 항목을 배포
* 정렬 키를 사용해서 오름차순으로 정렬
* 정렬 키의 최대 크기는 1,024 바이트
* 핫 파티션(대량의 읽기 쓰기가 발생하는 파티션)이 되는 것을 방지하지 위해서 파티션 키를 최대한 고유하게 만들어야함(타임 스탬프를 사용하는 경우가 많음)

### 속성과 항목

* 각 키-값 페어는 속성을 구성하고 하나 이상의 속성은 항목을 구성
* DynamoDB가 저장할 수 있는 항목의 최대 크기는 400KB
* 속성을 생성할 때는 데이터 형식을 정해야 하며 세가지 범주가 있음
    * 스칼라 
        - 스칼라 데이터 형식은 하나의 값만 가질 수 있음
        - 문자열 데이터 형식은 UTF-8인코딩을 사용해 최대 400KB의 유니코드 데이터를 저장 가능
        - 숫자 데이터 형식은 최대 38자리의 양수나 음수 저장
        - 바이너리 데이터 형식은 바이너리 데이터를 Base64 비트 인코딩 형식으로 저장. 최대 400KB로 제한
        - 부울 데이터 형식은 true 또는 false 값을 저장
        - null 데이터 형식은 정의되지 않거나 알려지지 않은 속성을 나타냄 (null값을 포함 필요)
    * 집합
        - 집합 데이터 형식은 순서가 없는 스칼라값 목록을 담고 있음
        - 값은 집합 내에서 고유
        - 집합에는 하나 이상의 값이 포함
        - 숫자 집합, 문자열 집합, 바이너리 집합을 작성 가능
    * 문서
        - 문서 데이터 형식은 스칼라와 집합 데이터 형식의 제약을 벗어나는 여러 형식의 데이터를 담을 수 있도록 설계
        - 최대 32레벨까지 문서 형식 중첩 가능

### 처리 용량

* 테이블을 만들 때 애플리케이션에 필요한 초당 읽기 및 쓰기 횟수를 지정 필요 (프로비저닝된 처리량이라 부름)
* DynamoDB는 테이블을 만들 때 지정한 읽기 용량 단위(RCU) 및 쓰기 용량 단위(WCU) 갯수로 파티션 예약

* 강력한 일관된 읽기 또는 최종적 일괄된 읽기로 테이블에서 항목 읽기 가능
* 강력한 일관된 읽기는 항상 최신 데이터를 제공
* 최종적 일관된 읽기는 최근 쓰기 작업의 데이터를 반영하지 못하는 이전 데이터를 만듬
* 애플리케이션이 이전 데이터 읽기를 허용하는 지에 따라 읽기 유형 결정
    - 1개의 RCU는 1개의 강력한 일관된 초당 읽기 제공 (최대 4KB 크기의 항목 기준)
    - 1개의 RCU는 2개의 최종적 일관된 초당 읽기 제공 (최대 4KB 크기의 항목 기준)
* 데이터 쓰기의 경우, 1개의 WCU는 최대 1KB 크기의 항목 1개 쓰기 제공

* DynamoDB가 제공하는 최대 처리 용량은 사용자가 지정, 이를 초과하면 DynamoDB는 요청을 차단

* Auto Scaling
    - 시간에 따라 처리량 요구가 달라질 것으로 예상할 때 Auto Scaling을 구성해서 처리량을 자동으로 증가
    - Auto Scaling을 구성할 때 최소/최대 RCU WCU를 지정하고 목표 사용률을 지정

* 예약 용량
    - WCU나 RCU가 100이상 필요할 때, 예약 처리 용량을 구매해서 비용 절약 가능

### 데이터 읽기

* DynamoDB는 테이블에서 두 가지 방식으로 데이터를 읽음
    - 스캔
        - 모든 테이블 항목을 나열하며, 읽기 집약적 작업이므로 프로비저닝된 용량 단위를 모드 사용할 가능성이 있음
    - 쿼리
        - 파티션 키값을 기반으로 항목을 반환
        - 쿼리를 수행할 때 검색하는 파티션 키의 값은 항목의 값과 정확히 일치 필요

* 보조 인덱스
    - 보조 인덱스는 DynamoDB에서 데이터를 쿼리할 때 발생하는 문제를 해결
        - 사용자는 특정 항목을 쿼리할 때 파티션 키를 정확하게 지정 필요
        - 보조 인덱스를 만들 때 기본 테이블에서 인덱스로 복사할 속성을 선택 가능 (프로젝션된 속성이라 부름)
    - 글로벌 보조 인덱스 (GSI)
        - 글로벌 보조 인덱스에서 파티션 키와 해시 키는 기본 테이블과 다를 수 있지만 기본 키 선택와 같은 규칙 적용
        - 항상 읽기 일관성 유지
    - 로컬 보조 인덱스 (LSI)
        - 기본 테이블과 동시에 만들어져야 함
        - 일단 만들면 삭제 불가
        - 파티션 키는 항상 기본 테이블과 같아야 하지만 정렬 키는 다를 수 있음
