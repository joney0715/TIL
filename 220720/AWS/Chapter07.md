# 7-4 CloudWatch 경보

- CloudWatch  경보는 단일 지표를 감시하고 일정 기간 동안 해당 지표를 감시하고 일정 기간 동안 행당 지표에 대해 경보를 생성 가능
- 이를 받은 CloudWatch는 메일 알림, 인스턴스 재부팅, Auto Scaling 등의 작업 가능



## 모니터링할 데이터 포인트

- 통계값으로 백분위를 사용할 때
  - 통계적으로 유의미한 데이터 포인트 수가 누적될 때까지 경보가 전송된 데이터 포인트를 무시할지 선택
  - 통계적으로 유의미하기 위해서 백분위를 설정 필요

### 

## 임계값

- 임계값은 모니터링할 데이터 포인트가 특정 기준을 충족하거나 문제가 발생했다는 것을 알려주는 값
- 경보의 트리거 역할



## 경보 상태

- 경보에는 3가지 상태가 있음
  - ALARM : 경보에 대한 데이터 포인트가 일정 시간 동안 지정된 임계값을 초과한 경우
  - OK : 경보에 대한 데이터 포인트가 일정 시간 동안 지정된 임계값 범위에 있는 경우
  - INSUFFICIENT_DATA : 경보에 대한 데이터 포인트가 지정된 임계값을 넘었는지를 결정하기에 충분한 데이터를 확보 못한 경우
- 새로운 경보는 INSUFFICIENT_DATA 상태에서 시작



## 경보에 대한 데이터 포인트와 평가 기간

- 경보에 대한 데이터 포인트에 따라 경보 상태를 변경하는 경우, 데이터 포인트가 임계값을 초과한 뒤 유지되는 기간에 따라 달라짐
- 경보에 대한 데이터 포인트와 같거나 큰 평가 기간을 설정해야 하는 경우
  - 모니터링할 데이터 포인트가 주기적으로 임계값을 넘지만 계속 유지되는 것은 아닐 때 트리거를 해야할 때
- CloudWatch가 연속적은 데이터 포인트 45, 30, 25를 평가한 결과
  - 3개 데이터 포인터 중 2개가 임계값 아래로 떨어지므로 경보는 ALARM 상태로 전환
  - CloudWatch는 경보 상태를 변경하기 전에 3개 데이터 포인트를 평가



## 누락 데이터

- 평가 기간중에 EBS 볼륨을 인스턴스에서 분리하거나 인스턴스를 중지하면 로그 데이터가 누락될 수 있음
- CloudWatch 에서 누락 데이터를 평가하는 방법
  - As missing : 누락 데이터를 마치 발생한 적 없는 것 취급
  - Not Breaching : 누락 데이터 포인트가 임계값을 위반하지 않는 것으로 간주
  - Breaching : 누락 데이터 발생시 임계값으로 위반하는 것으로 간주
  - Ignore : 경보에 대한 데이터 포인트설정에서 지정된 연속적인 데이터 포인트 개수를 수신할 때까지 상태 변경 안 함



## 작업

- 상태 전환시 작업을 수행하도록 경보를 구성할 수 있음
- 경보가 ALARM 상태로 전환될 때, OK 상태로 전환될 때도 CloudWatch가 작업을 수행하게 할 수 있음
- 이 기능은 CPU 사용률이 비정상적으로 높을 때나 정상으로 복구될 때의 알림으로 유용
- 인스턴스를 모니터링하는 경보가 INSUFFICIENT_DATA 상태가 될 때 작업을 트리거 가능
  - Simple Notification Service(SNS)을 이용한 알림
    - SNS는 주제라고 하는 통신 채널 사용
    - 발신자나 게시자가 구독자라고 하는 한 명 이상의 수신자들에서 알람을 보냄
    - 구독자는 프로토콜과 앤드포인트로 구성
    - 프로토콜은 HTTP, HTTPS, SQS, Lambda, 모바일 푸시, 메일, SMS 등을 사용 가능
  - Auto Scaling 작업
    - 간단한 Auto Scaling 정책을 만들어 인스턴스를 추가하거나 제거 가능
    - 경보 작업을 선택하기 전에 먼저 정책 생성
  - EC2 작업
    - 경보 상태에 대한 응답
    - 인스턴스 중지, 종료, 재부팅, 복구할 수 있음
    - 인스턴스의 문제를 확인 가능하며, 인스턴스를 재부팅해서 해결
