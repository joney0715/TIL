## 7-3 CloudWatch Logs

- AWS 와 비AWS 원본에서 로그를 수집해서 저장
- Cloud scape에서 사용자 정의 지표를 검색하고 추출까지 가능
- CloudTrail 로그 수신, 인스턴스에서 애플리케이션 로그 수집, Route 53 DNS 쿼리 기록 등의 기능을 제공



### 로그 스트림과 로그 그룹

- CloudWatch Logs는 로그 이벤트, 즉 애플리케이션이나 AWS 리소스에서의 활동 기록을 저장
- CloudWatch Log가 로그 이벤트를 이해하려면 이벤트에 타임스탬프와 UTF-8으로 인코딩된 이벤트 메시지가 있어야 함



- CloudWatch Log는 같은 원본(애플리케이션, AWS 리소스)에서 나온 로그 이벤트를 로그 스트림에 저장

  - 인스턴스가 여러 개에서 액세스 로그가 생성될 때, 각 인스턴스는 CloudTrail에 별도 스트림으로 해당 로그르 보냄
  - 로그 스트림은 삭제 가능하지만 개별 로그 이벤트는 삭제 불가

  

- CloudWatch는 로그 스트림을 로그 그룹에 포함 가능, 하나의 스트림은 하나의 그룹에만 속함

- 로그 스트림을 효율적으로 관리하려면 유사한 로그 스트림을 같은 로그 그룹에 배치(수의 제한 없음)



### 지표 필터

- 지표 필터로 로그 그룹의 로그로부터 데이터를 추출해서 CloudWatch 지표를 만들 수 있음
  - 로그 파일의 특정 위치에서 문자열의 발생을 추적 가능
- 지표 값은 숫자
- 지표 필터가 특정 문자열과 일치할 때는 지표에 추가 가능
- 지표 필터는 로그 그룹에 적용
- 지표 필터를 만들기 전에 기록된 CloudWatch 로그 이벤트로는 지표 생성 불가



### CloudWatch 에이전트

- CloudWatch 에이전트는 Linux 나 Window 운영 체제를 실행하는 EC2 인스턴스와 온프레미스 서버에서 로그를 수집
- EC2에서 생성하는 지표와 메모리 사용률 같이 기본으로 지원하지 않는 지표를 포함해서 성능 지표를 수집 가능
- 사용자 지정 지표는 에이전트가 생성한 지표이며 사용자 제정 네임 스페이스에 저장



### CloudTrail Logs를 CloudWatch Logs 로 전송

- CloudTrail 을 구성해서 추적 로그를 CloudWatch Logs의 로그 스트림에 보내고, 이를 통해 추적 로그에서 지표를 추출하고 검색 가능
- CloudTrail은 JSON형식의 추적 로그를 생성해서 지정한 S3 버킷에 저장 가능하지만, 검색은 불가
- CloudWatch는 JSON 형식으로 특정 이벤트를 검색 가능
- 사용자가 검색하려는 로그 그룹과 IAM 역할을 지정하면 CloudTrail은 자동으로 역할을 생성하고 로그 그룹에 역할 부여

